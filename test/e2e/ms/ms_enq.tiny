def enq begin
  node := new;
  while true do
    tail := Tail;
    next := tail.next;
    if next = null then
      if CAS(tail.next, next, node, enq) then
        CAS(Tail, tail, node, enq_swing);
        break;
      fi
    else
      CAS(Tail, tail, next, enq_swing);
    fi
  od
end
