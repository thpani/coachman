def deq begin
  while true do
    head := Head;
    tail := Tail;
    next := head.next;
    if !(head = Head) then continue; fi
    if head = tail then
      if next = null then break;
      else CAS(Tail, tail, next, deq_swing);
      fi
    else
      if CAS(Head, head, next, deq) then
        break;
      fi
    fi
  od
end
