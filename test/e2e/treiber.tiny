def push begin
  node := new;
  while true do
    top := ToS;
    node.next := top;
    if CAS(ToS, top, node) then
      break;
    fi
  od
end

def pop begin
  while true do
    top := ToS;
    if top = null then
      break;
    fi
    node := top.next;
    if CAS(ToS, top, node) then
      break;
    fi
  od
end
