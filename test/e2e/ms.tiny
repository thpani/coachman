def enq begin
  node := new;
  while true do
    tail := Tail;
    next := tail.next;
    if next = null then
      if CAS(tail.next, next, node) then
        CAS(Tail, tail, next);
        break;
      fi
    else
      CAS(Tail, tail, next);
    fi
  od
end
